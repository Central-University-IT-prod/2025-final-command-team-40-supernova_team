# Supernova | Backend

## Запуск

Для локального запуска достаточно поднять Docker Compose

```shell
docker compose up -d
```

## Swagger

При запуске приложения можно увидеть спецификацию на `/docs`

[тык](https://prod-team-40-jpqgdebk.REDACTED/docs#/)

## Тесты

### Unit

```shell
# *create venv*

pip install -r requirements.txt
pip install pytest

python -m pytest ./tests/unit/
```

### E2E

> [!NOTE]
> Некоторые тесты требуют доступа к сторонним интеграциям, для которых могут быть необходимы ключи доступа

```shell
# *create venv*

pip install pytest tavern

python -m pytest ./tests/e2e/
```

<details>
<summary>uv</summary>

```shell
uvx --with tavern pytest ./tests/e2e/
```

</details>

## CI/CD

Для бэкенда настроен [gitlab ci](./.gitlab-ci.yml), производящий деплой на виртуальную машину.

## Структура проекта

| Path            | Description                                                                     |
| --------------- | ------------------------------------------------------------------------------- |
| `integrations/` | [Сторонние интеграции (ИИ, Kinopoisk API, ...)](#интеграции)                    |
| `routers/`      | API бэкенда                                                                     |
| `services/`     | [Внутренние сервисы (БД, кэш, статическое хранилище, ...)](#внутренние-сервисы) |
| `login_manager` | Auth для пользователей                                                          |

## Интеграции

### Кинопоиск

Интеграция с сервисом Кинопоиск позволяет добавлять в свою коллекцию любые фильмы, доступные на платформе сервиса,
а также получать большое количество информации о любом фильме.

### ИИ для генерации дискуссий

ИИ помогает сгенерировать темы для обсуждения после просмотра фильма.

## Внутренние сервисы

### База данных

База данных - PostgresQL

![схема бд](./assets/db_scheme.jpg)

### Статическое хранилище

Для хранения изображений превью фильмов используется Minio

При получении фильма, в поле `image_url` будет указана действительная ссылка на изображение

## Дополнительные фичи бэкенда

### SSL

SSL with nginx

---

## Порты

| Port  |    Service    |
| :---: | :-----------: |
|  80   |      API      |
| 8001  |  PostgresQL   |
| 8002  |     Redis     |
| 8003  |     Minio     |
| 8004  | Minio console |